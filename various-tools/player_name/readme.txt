Same-ish implementation from sysmes, but without the bodge. Usage is similar too.